name: reactor-go-jira
description: |
  This campaign creates Jira tickets
on:
  - repository: github.com/sourcegraph-testing/tiny-go-test-repository

steps:
  - run: comby -in-place 'fmt.Sprintf("%d", :[v])' 'strconv.Itoa(:[v])' .go -matcher .go -exclude-dir .,vendor; echo "issue"
    container: comby/comby
    outputs:
      modifiedFiles:
        value: "${{ step.modified_files }}"
  - run: >
      python ../create-jira.py
      --summary 'Update ${{repository.name}}'
      --description 'Modify ${{ previous_step.modified_files }}'
      --campaign_name "reactor-go-jira"
      --jira_sitename mmgcn
      --jira_username mm@getcloudnative.fr
      --jira_token $JIRA_TOKEN
      --jira_project MP
    container: malomarrec/src-py-jira:latest
    env:
      - JIRA_TOKEN
    outputs:
      issueLink:
        value: ${{step.stdout}}

changesetTemplate:
  title: Replace fmt.Sprintf with equivalent strconv.Itoa
  body: |
    Linked issue: ${{outputs.issueLink}}
  branch: campaigns/sprintf-to-itoa
  commit:
    message: Replacing fmt.Sprintf with strconv.Iota
  published: false
